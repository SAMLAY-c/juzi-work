summaries:
  avgProgress: values.filter(value.isType("number")).mean().round(1)
  totalBudget: values.filter(value.isType("number")).sum()
  avgTasks: values.filter(value.isType("number")).mean().round(1)
  overdueCount: values.filter(value == true).length()
filters:
  or:
    - file.hasTag("type/project")
    - file.hasTag("type/é¡¹ç›®")
    - file.inFolder("01 - ä¸ªäºº/é¡¹ç›®")
formulas:
  progress_percent: if(total_tasks > 0, (completed_tasks / total_tasks * 100).round(0), 0)
  progress_bar: if(progress, "â–°".repeat(progress.round(0) / 5) + "â–±".repeat(20 - progress.round(0) / 5), "")
  status_icon: if(status == "planning", "ğŸ“‹", if(status == "active", "ğŸš€", if(status == "paused", "â¸ï¸", if(status == "completed", "âœ…", if(status == "cancelled", "âŒ", "â“")))))
  priority_icon: if(priority == "high", "ğŸ”´ é«˜", if(priority == "medium", "ğŸŸ¡ ä¸­", "ğŸŸ¢ ä½"))
  is_overdue: if(due_date && status != "completed" && status != "cancelled", date(due_date) < today(), false)
  days_until_due: if(due_date, ((date(due_date) - today()) / 86400000).round(0), "")
  overdue_warning: 'if(is_overdue, "âš ï¸ é€¾æœŸ " + ((today() - date(due_date)) / 86400000).round(0).toString() + " å¤©", if(days_until_due != "", (days_until_due >= 0 ? "ğŸ”œ è¿˜æœ‰ " + days_until_due.toString() + " å¤©" : "âš ï¸ å·²é€¾æœŸ " + (days_until_due * -1).toString() + " å¤©"), ""))'
  stakeholder_count: if(stakeholders, stakeholders.length, 0)
  stakeholders_short: if(stakeholder_count > 2, stakeholders.slice(0, 2).join(", ") + " ç­‰" + stakeholder_count.toString() + "äºº", if(stakeholder_count > 0, stakeholders.join(", "), "æ— "))
  task_completion: if(total_tasks > 0, completed_tasks + "/" + total_tasks + " (" + progress_percent + "%)", "")
  duration_days: if(start_date && due_date, ((date(due_date) - date(start_date)) / 86400000).round(0), if(start_date, ((today() - date(start_date)) / 86400000).round(0), ""))
  last_updated: file.mtime.relative()
  created_date: file.ctime.format("YYYY-MM-DD")
  completion_time: if(completed_date && start_date, ((date(completed_date) - date(start_date)) / 86400000).round(0) + " å¤©", "")
  budget_usage: if(budget > 0, "Â¥" + actual_cost + " / Â¥" + budget + " (" + (actual_cost / budget * 100).round(0) + "%)", "")
  has_dependencies: if(depends_on, depends_on.length > 0, false)
  dependencies_display: if(has_dependencies, depends_on.join(", "), "æ— ")
properties:
  status:
    displayName: çŠ¶æ€
  priority:
    displayName: ä¼˜å…ˆçº§
  formula.priority_icon:
    displayName: ä¼˜å…ˆçº§
  progress:
    displayName: è¿›åº¦%
  formula.progress_bar:
    displayName: è¿›åº¦æ¡
  stakeholders:
    displayName: å¯¹æ¥äºº
  formula.stakeholders_short:
    displayName: å¯¹æ¥äºº
  formula.stakeholder_count:
    displayName: äººæ•°
  start_date:
    displayName: å¼€å§‹æ—¥æœŸ
  due_date:
    displayName: åˆ°æœŸæ—¥æœŸ
  formula.days_until_due:
    displayName: è·ç¦»åˆ°æœŸ
  formula.overdue_warning:
    displayName: çŠ¶æ€æç¤º
  category:
    displayName: åˆ†ç±»
  total_tasks:
    displayName: æ€»ä»»åŠ¡
  completed_tasks:
    displayName: å·²å®Œæˆ
  formula.task_completion:
    displayName: å®Œæˆæƒ…å†µ
  formula.last_updated:
    displayName: æ›´æ–°æ—¶é—´
  formula.duration_days:
    displayName: æŒç»­å¤©æ•°
  depends_on:
    displayName: ä¾èµ–
  formula.dependencies_display:
    displayName: ä¾èµ–é¡¹ç›®
  budget:
    displayName: é¢„ç®—
  actual_cost:
    displayName: å®é™…èŠ±è´¹
  formula.budget_usage:
    displayName: é¢„ç®—ä½¿ç”¨
views:
  - type: table
    name: é¡¹ç›®æ€»è§ˆ
    filters:
      not:
        - status == "cancelled"
    groupBy:
      property: category
      direction: ASC
    order:
      - formula.status_icon
      - file.name
      - status
      - formula.priority_icon
      - formula.progress_bar
      - progress
      - formula.stakeholders_short
      - due_date
      - formula.overdue_warning
      - formula.task_completion
      - formula.last_updated
    summaries:
      progress: avgProgress
      budget: totalBudget
      total_tasks: avgTasks
      formula.is_overdue: overdueCount
  - type: table
    name: æ´»è·ƒé¡¹ç›®
    filters:
      and:
        - status == "active"
    groupBy:
      property: priority
      direction: DESC
    order:
      - formula.status_icon
      - file.name
      - formula.priority_icon
      - formula.progress_bar
      - progress
      - stakeholders
      - due_date
      - formula.overdue_warning
      - formula.task_completion
      - formula.last_updated
  - type: table
    name: è®¡åˆ’ä¸­é¡¹ç›®
    filters:
      and:
        - status == "planning"
    order:
      - formula.priority_icon
      - file.name
      - category
      - stakeholders
      - start_date
      - due_date
      - formula.dependencies_display
  - type: table
    name: å·²å®Œæˆé¡¹ç›®
    filters:
      and:
        - status == "completed"
    order:
      - formula.status_icon
      - file.name
      - completed_date
      - formula.completion_time
      - progress
      - formula.task_completion
      - budget
      - actual_cost
      - formula.budget_usage
  - type: cards
    name: é¡¹ç›®å¡ç‰‡
    filters:
      not:
        - status == "cancelled"
    groupBy:
      property: status
      direction: ASC
    order:
      - file.name
      - status
      - formula.progress_bar
      - stakeholders
      - due_date
      - formula.overdue_warning
      - formula.task_completion
  - type: table
    name: é¡¹ç›®çœ‹æ¿
    filters:
      not:
        - status == "cancelled"
    groupBy:
      property: status
      direction: ASC
    order:
      - formula.status_icon
      - file.name
      - formula.priority_icon
      - formula.progress_bar
      - stakeholders
      - formula.overdue_warning
      - formula.task_completion
  - type: table
    name: é€¾æœŸå’Œç´§æ€¥
    filters:
      or:
        - is_overdue == true
        - and:
            - priority == "high"
            - status != "completed"
            - status != "cancelled"
    order:
      - formula.overdue_warning
      - formula.priority_icon
      - file.name
      - status
      - due_date
      - stakeholders
      - formula.progress_bar
  - type: table
    name: æŒ‰å¯¹æ¥äºº
    filters:
      and:
        - stakeholder_count > 0
    groupBy:
      property: stakeholders
      direction: ASC
    order:
      - stakeholders
      - file.name
      - status
      - formula.priority_icon
      - formula.progress_bar
      - due_date
      - formula.overdue_warning
  - type: table
    name: ä¾èµ–å…³ç³»
    filters:
      and:
        - has_dependencies == true
    order:
      - file.name
      - status
      - formula.dependencies_display
      - blocks
      - formula.progress_bar
      - stakeholders
  - type: table
    name: è´¢åŠ¡å’Œèµ„æº
    filters:
      or:
        - budget > 0
        - actual_cost > 0
    order:
      - file.name
      - status
      - budget
      - actual_cost
      - formula.budget_usage
      - formula.progress_bar
      - stakeholders
    summaries:
      budget: totalBudget
      actual_cost: totalBudget
  - type: table
    name: æ—¶é—´çº¿
    filters:
      and:
        - start_date != ""
    order:
      - start_date
      - file.name
      - status
      - due_date
      - formula.duration_days
      - formula.progress_bar
      - stakeholders
  - type: list
    name: é¡¹ç›®æ¸…å•
    filters:
      not:
        - status == "cancelled"
    order:
      - file.name
      - status
      - formula.priority_icon
