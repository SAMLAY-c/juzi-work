
![[Pasted image 20260126101727.png]]
### 1. 核心逻辑架构
整个流程采用了 **“信息初筛 -> 简称提取 -> 规则判断 -> 模糊消歧（搜索+反问）”** 的漏斗式处理逻辑。

*   **输入端**：用户的自然语言（可能是模糊的、口语化的）。
*   **处理端**：通过大模型判断是全称还是简称。
*   **决策端**：如果是全称则直接采纳（或进入下一步）；如果是简称或不确定，则调用外部工具搜索，并把结果返还给用户确认。
*   **输出端**：标准化的公司全称，或者修改用户备注。

---

### 2. 节点详细拆解与思路分析

#### 第一阶段：意图识别与初步清洗（对应图中左侧“公司主体收集”节点）
*   **使用提示词**：Prompt 1 (# 提示词1)
*   **设计思路**：
    *   **区分全称与简称**：这是整个流程的“守门员”。提示词明确要求调用工具（博查搜索）来校验用户提供的是否为全称。
    *   **输出三态**：
        1.  **公司全称**：用户直接提供了标准全名（如“深圳腾讯计算机系统有限公司”）。
        2.  **False**：用户提供了简称（如“我是腾讯的”），标记为 `false`，为后续的搜索流程做铺垫。
        3.  **未知**：用户没提公司。
    *   **关键约束**：必须是**用户所在**的公司，排除用户随口聊到的其他公司，防止错误关联。

#### 第二阶段：关键信息提取（对应图中中间“提取公司简称”节点）
*   **使用提示词**：Prompt 2 (# 提示词2)
*   **设计思路**：
    *   **承接上一步**：当用户说的是简称（Prompt 1 输出 False 或文本）时，需要把这个“简称”精准地抠出来，作为后续搜索引擎的关键词。
    *   **人设与约束**：人设是“简称提取专员”，核心能力是**零臆测**。提示词反复强调“无法确定”时不要瞎编，目的是保证传递给搜索工具的关键词必须是准确的。
    *   **去噪**：如果上下文提及多家公司，只提取用户所属的那一家，确保搜索源头的纯净度。

#### 第三阶段：逻辑分流（对应图中“规则中心”节点）
*   **设计思路**：
    *   这里是一个条件判断节点（Router）。
    *   **路径 A（无法确认/Else）**：如果前序步骤提取到的是“简称”或者“不确定的名称”，流程走向右侧的“补全”分支。
    *   **路径 B（已有全称）**：(图中线未画全，但逻辑上) 如果Prompt 1直接拿到了全称，可能直接跳过搜索，或者进入数据更新流程。

#### 第四阶段：模糊消歧与确认（对应图中右侧的一系列节点）
*   **节点流**：`搜索公司全称` -> `获取公司名称集合` -> `反问客户公司名称`
*   **使用提示词**：Prompt 3 (# 提示词3)
*   **设计思路**：
    *   **工具调用**：利用上一步提取的“简称”，调用“搜索公司全称”工具，从企查查/天眼查等数据库获取一个候选列表（例如搜“字节”，返回“字节跳动有限公司”、“北京字节...”等）。
    *   **把选择权交给用户**：这是该工作流最聪明的设计。模型不替用户做最终决定（避免幻觉导致的错误归档），而是将搜索结果整理成编号列表，让用户自己选。
    *   **话术引导**：Prompt 3 明确要求“不要替用户选择”，而是输出“请问您公司的全称是什么呢？”，并附带选项。

#### 第五阶段：辅助功能分支（对应图下方“修改备注”路径）
*   **设计思路**：
    *   这是一个并行的功能意图。如果用户说的是“帮我改个备注”而非提供公司信息，Prompt 1 或前置分类器会将流量分发到下方的蓝色路径。
    *   执行逻辑：赋值 -> 获取ID -> 调用系统API修改备注。

---

### 3. 整体思路总结（该工作流解决了什么痛点？）

1.  **解决了“简称歧义”问题**：
    用户通常只说“我是百度的”，不会说全称。直接存“百度”是不合规的（CRM需要全称）。这个流程通过**“提取简称 -> 搜索候选 -> 用户确认”**的闭环，把口语简称转化为了标准全称。

2.  **解决了“模型幻觉”问题**：
    Prompt 2 和 Prompt 3 都有严格的约束（“零臆测”、“不要替用户选择”）。系统宁可输出“无法确定”让用户重输，也不愿意自动填一个错误的公司名。

3.  **数据准确性优先**：
    Prompt 1 专门增加了一个校验步骤（判断是否为全称），确保了进入数据库的信息必须是高质量的。

### 总结一句话：
这是一个**“以用户所属公司为核心，利用大模型进行语义提取，结合外部搜索工具进行数据补全，最后通过人机交互完成数据清洗与确认”**的自动化工作流。